{% extends "dgenerales.html" %}


{% block content %}
{% load forms_tags %}
{% load custom_filters %}
{% load form_utils %}

<body>

<div class="card shadow-sm">
  <div class="card-body ">

    <h3>Reporte de Valorizacion</h3>
  <!-- CÓDIGO CORREGIDO Y RECOMENDADO -->
<div class="patient-info d-flex align-items-center">
    <!-- Información del paciente (se queda igual) -->
    <div>
        <div class="d-inline-block me-3 fs-5">
            <label>Expediente:</label>
            <span>{{ interno.numeroexpediente }}</span>
        </div>
        <div class=" d-inline-block me-3 fs-5">
            <label>Nombre:</label>
            <span>{{ interno.nombrecompleto }}</span>
        </div>
    </div>

    <div class="ms-auto d-flex align-items-center gap-3">

        <a href="{% url 'seleccionainterno' id=interno.pk %}?opcion=seleccionar"
           class="btn btn-primary"
           style="--bs-btn-padding-y: .5rem; --bs-btn-padding-x: .75rem;margin-right:25px;margin-bottom:5px;">
           Regresar
        </a>
    </div>
</div>
  </div>
</div>
<div class="container">
    <div class="card shadow-sm mt-0">
        <div class="card-body">
            <div class="row border rounded p-0 shadow-sm">

                <div class="col-md-4 ">
                    <!-- CORRECCIÓN 1: Estructura de formulario Bootstrap estándar -->
                    <div class="mb-0">
                      <div class="d-flex align-items-center">
                        <label class="form-label me-2 mb-0">{{ valorizacionf.mainsustance.label }}</label>
                        <!-- CORRECCIÓN 2: Mostrar el texto legible en lugar del número -->
                        <div class=" fs-6 ">

                            <strong>{{ valorizacionf.instance.get_mainsustance_display }}</strong>
                        </div>
                      </div>
                    </div>
                </div>
                <!-- Columna para 'Hace Cuánto' -->
                <div class="col-md-4">
                     <label class="form-label me-2 mb-0">{{ valorizacionf.hacecuanto.label }}</label>
                </div>
                {{valorizacionf.cantidadapromedio.as_hidden}}
                {{valorizacionf.hacecuanto.as_hidden}}
                <div class="col-md-4 ">
                         <label class="form-label me-2 mb-0">{{ valorizacionf.cantidadpromedio.label }}</label>
                 </div>

                <div class="col-md-4">
                </div>
                <!-- Columna para 'Principal Sustancia' -->
                <div class="col-md-4 mb-2 from-control-plaintext">
                      {{ valorizacionf.hacecuanto }}
                </div>
                <div class="col-md-4 mb-2 ">
                     <div class="from-control-plaintext">
                     <strong>{{ valorizacionf.cantidadpromedio}}</strong>
                     </div>
                 </div>
                </div>
                </div>
                </div>

    <div class="card shadow-sm">
        <div class="card-body">
             <div class="row align-items-center">
                <!-- Columna para 'Hace Cuánto' -->
                <div class="col-md-6">
                    <div class="card shadow-sm">
                      <div class="card-header">
                          <label class="form-label me-0 mb-0"><strong>Razones principales de consumo</strong></label>
                      </div>
                     <div class="card-body mt-3 mb-3">
                         <table class="table table-striped mb-0">
                         <tbody>
                         <thead></thead>
                         {% for consecuencia in einicial.resumen_razones_principales %}
                            <tr>
                                <td class="mb-1">{{ consecuencia.nombre }}</td>
                            </tr>

                       {% empty %}
                      <tr>Sin razones principales de consumo registradas.</tr>
                      {% endfor %}
                     </tbody>
                         </table>
                     </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card shadow-sm">
                       <div class="card-header">
                           <label class="form-label me-0 mb-0"><strong>3 Razones por las cuales quiere dejar de consumir</strong></label>
                       </div>
                       <div class="card-body mt-3 mb-3">
                           <table class="table mb-0">
                               <thead></thead>
                               <tr></tr>
                               <tbody>
                               <tr>
                               <td>{{valorizacionf.razon1}}</td>
                               </tr>
                               <tr>
                               <td>{{valorizacionf.razon2}}</td>
                               </tr>
                               <tr>
                               <td>{{valorizacionf.razon3}}</td>
                               </tr>
                               </tbody>
                           </table>
                       </div>
                    </div>
                </div>
                </div>
                </div>

            </div> <!-- Fin de .row -->
  <div class="card shadow-sm">
        <div class="card-body">
             <div class="row align-items-center">
                <!-- Columna para 'Hace Cuánto' -->
                <div class="col-md-6">
                    <div class="card shadow-sm">
                      <div class="card-header">
                          <strong>Sintomas de Psicosis (Puntaje : {{psicosis.pspuntos}})</strong>
                      </div>
                     <div class="card-body p-0">
                          <table class="table table-striped mb-0">
            <thead >
                <tr>
                    <th class="fw-normal mt-0">Sintoma</th>
                    <th class="text-center fw-normal mt-0">Afectacion</th>

                </tr>
            </thead>
            <tbody>
               {% for sintoma in psicosis.sintomas_psicosis %}

                <tr>
                    <td class="align-middle " style="font-size:0.8rem">{{ sintoma.nombre }}</td>
                    <td class="text-center align-middle">
                        {% if sintoma.severidad == 'Mucho' %}
                            <span class="badge bg-danger">{{ sintoma.severidad }}</span>
                        {% elif sintoma.severidad == 'Bastante' %}
                            <span class="badge bg-danger-subtle text-dark">{{ sintoma.severidad }}</span>
                        {% elif sintoma.severidad == 'Poco' %}
                            <span class="badge bg-warning">{{ sintoma.severidad}}</span>
                         {% elif sintoma.severidad == 'Muy Poco' %}
                            <span class="badge bg-warnig-subtle">{{ sintoma.severidad}}</span>
                         {% else %}
                            <span class="badge bg-success">{{ sintoma.severidad}}</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3" class="text-center text-muted">No hay sintomas significativos registrados.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

                </div>
                    </div>
                </div>
                <div class="col-md-6">
    <div class="card">
    <div class="card-header">
        <strong>Resumen de Riesgos Principales (Cuestionario ASSIST)</strong>
    </div>
       <div class="card-body p-0">
        <table class="table table-striped mb-0">
            <thead >
                <tr>
                    <th class="fw-normal">Sustancia</th>
                    <th class="text-center fw-normal">Puntuación</th>
                    <th class="text-center fw-normal">Nivel de Riesgo</th>
                </tr>
            </thead>
            <tbody>
                {% for item in assist.resumen_riesgos_principales %}
                <tr>
                    <td class="align-middle">{{ item.nombre }}</td>
                    <td class="text-center align-middle">{{ item.puntuacion }}</td>
                    <td class="text-center align-middle">
                        {% if item.riesgo == 'Alto' %}
                            <span class="badge bg-danger">{{ item.riesgo }}</span>
                        {% elif item.riesgo == 'Moderado' %}
                            <span class="badge bg-warning text-dark">{{ item.riesgo }}</span>
                        {% else %}
                            <span class="badge bg-success">{{ item.riesgo }}</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3" class="text-center text-muted">No hay riesgos significativos registrados.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
                </div>
             </div>
            <div class="row align-items-center mt-2">
          <div class="col-md-6">
                    <div class="card shadow-sm">
                      <div class="card-header">
                          <strong>Sintomas de Ansiedad (Puntaje : {{ansiedad.anpuntos}})</strong>
                      </div>
                     <div class="card-body p-0">
                          <table class="table table-striped mb-0">
            <thead >
                <tr>
                    <th class="fw-normal mt-0">Sintoma</th>
                    <th class="text-center fw-normal mt-0">Afectacion</th>

                </tr>
            </thead>
            <tbody>
               {% for sintoma in ansiedad.sintomas_ansiedad %}

                <tr>
                    <td class="align-middle " style="font-size:0.8rem">{{ sintoma.nombre }}</td>
                    <td class="text-center align-middle">
                        {% if sintoma.severidad == 'Severamente' %}
                            <span class="badge bg-danger">{{ sintoma.severidad }}</span>
                        {% elif sintoma.severidad == 'Moderadamente' %}
                            <span class="badge bg-danger-subtle text-dark">{{ sintoma.severidad }}</span>
                        {% elif sintoma.severidad == 'Mas o menos' %}
                            <span class="badge bg-warning">{{ sintoma.severidad}}</span>
                        {% else %}
                            <span class="badge bg-success">{{ sintoma.severidad}}</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3" class="text-center text-muted">No hay sintomas significativos registrados.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

                </div>
                    </div>
                </div>

          <div class="col-md-6">
                    <div class="card shadow-sm">
                      <div class="card-header">
                          <strong>Sintomas de Depresion (Puntaje : {{depresion.deppuntos}})</strong>
                      </div>
                     <div class="card-body p-0">
                          <table class="table table-striped mb-0">
            <thead >
                <tr>
                    <th class="fw-normal mt-0">Sintoma</th>


                </tr>
            </thead>
            <tbody>
               {% for sintoma in depresion.sintomas_depresion %}

                <tr>
                    <td class="align-middle " style="font-size:0.8rem">{{ sintoma.nombre }}</td>

                </tr>
                {% empty %}
                <tr>
                    <td colspan="3" class="text-center text-muted">No hay sintomas significativos registrados.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

                </div>
                    </div>
                </div>



                </div>
    <div class="row align-items-center mt-3">
        <div class="col-md-6">
<div class="card">
    <div class="card-header">
        <strong>Resumen de Satisfacción de Vida</strong>
    </div>
    <div class="card-body p-0">
        <table class="table table-striped mb-0">
            <thead class="table-light">
                <tr>
                    <th class="fw-normal mt-0">Área de Vida</th>
                    <th class="text-center fw-normal mt-0">Nivel de Satisfacción</th>
                    <th class="text-center fw-normal mt-0 ">Puntuación</th>
                </tr>
            </thead>
            <tbody>
                {% for item in sdevida.satisfaccion_vida %}
                <tr>
                    <td class="align-middle" style="font-size:0.8rem">{{ item.area }}</td>
                    <td class="text-center align-middle">
                        {% if item.nivel == 'Totalmente Satisfecho' %}
                            <span class="badge bg-success">{{ item.nivel }}</span>
                        {% elif item.nivel == 'Satisfecho' %}
                            <span class="badge bg-primary">{{ item.nivel }}</span>
                        {% elif item.nivel == 'Insatisfecho' %}
                            <span class="badge bg-warning text-dark">{{ item.nivel }}</span>
                        {% elif item.nivel == 'Completamente Insatisfecho' %}
                            <span class="badge bg-danger">{{ item.nivel }}</span>
                        {% else %}
                             <span class="badge bg-secondary">{{ item.nivel }}</span>
                        {% endif %}
                    </td>
                    <td class="text-center align-middle"><strong>{{ item.puntuacion }}</strong></td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3" class="text-center text-muted">No hay datos de satisfacción para mostrar.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
        </div>
    </div>


</div> <!-- Fin de .container -->





  <div class="container-fluid py-3">
        <div class="card">
          <div class="card-header">
              <h4>Consecuencias adversas</h4>
          </div>
          <div class="card-body">
        <!-- 1. MENÚ DE NAVEGACIÓN FUNCIONAL Y ACCESIBLE -->
        <div class="overflow-auto ">
            <ul class="nav nav-tabs flex-nowrap" id="consecuenciasadversas" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active px-3" id="fisicas-tab" data-bs-toggle="tab" data-bs-target="#fisicas-panel" type="button" role="tab" aria-controls="fisicas-panel" aria-selected="true">Fisicas</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link px-3" id="emocionales-tab" data-bs-toggle="tab" data-bs-target="#emocionales-panel" type="button" role="tab" aria-controls="emocionales-panel" aria-selected="false">Emocionales</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link px-3" id="Relaciones-tab" data-bs-toggle="tab" data-bs-target="#relaciones-panel" type="button" role="tab" aria-controls="relaciones-panel" aria-selected="false">Relaciones con otros</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link px-3" id="laboral-tab" data-bs-toggle="tab" data-bs-target="#laboral-panel" type="button" role="tab" aria-controls="laboral-panel" aria-selected="false">Laboral y escolar</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link text-nowrap px-3" id="legal-tab" data-bs-toggle="tab" data-bs-target="#legal-panel" type="button" role="tab" aria-controls="legal-panel" aria-selected="false">Legal</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link px-3" id="economicos-tab" data-bs-toggle="tab" data-bs-target="#economicos-panel" type="button" role="tab" aria-controls="economicos-panel" aria-selected="false">Economicos</button>
                </li>

            </ul>
        </div>




    {% if messages %}
    <div class="alert-messages">
      {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
      {% endfor %}
    </div>
    {% endif %}


        <div class="tab-content" id="consecuenciasTabContent">

            <!-- Panel para Tabaco (Con tu texto original) -->
            <div class="tab-pane fade show active" id="fisicas-panel" role="tabpanel" aria-labelledby="fisicas-tab">
                <div class="card shadow-sm">
               <div class="card-body p-0 "> <!-- p-0 es opcional, para que la tabla ocupe todo el espacio de la tarjeta -->
                <table class="table table-striped mb-0">
              <thead class="table-light">
                   <tr>
                     <th scope="col">Consecuencia</th>
                     <th scope="col" class="text-center">Nivel de Afectación</th>
                   </tr>
               </thead>

            <tbody>
            {% for consecuencia in cfisicas.consecuencias_fisicas %}
            <tr>
                <td class="align-middle">
                    {{ consecuencia.nombre }}
                </td>


                <td class="text-center align-middle">
                    {% if consecuencia.severidad == 'Bastante' %}
                        <strong class="text-danger">{{ consecuencia.severidad }}</strong>

                    {% elif consecuencia.severidad == 'Regular' %}
                        <strong class="text-warning">{{ consecuencia.severidad }}</strong>

                    {% elif consecuencia.severidad == 'Poco' %}
                        <strong class="text-primary">{{ consecuencia.severidad }}</strong>

                    {% else %}
                        <strong>{{ consecuencia.severidad }}</strong>
                    {% endif %}
                </td>
            </tr>
            {% empty %}

            <tr>
                <td colspan="2" class="text-center text-muted">
                    Sin consecuencias físicas registradas.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

    </div>
            </div>

       <div class="tab-pane fade show " id="emocionales-panel" role="tabpanel" aria-labelledby="emocionales-tab">
                <div class="card shadow-sm">
<div class="card-body p-0"> <!-- Se usa p-0 para un ajuste perfecto de la tabla -->

    <!-- La estructura de lista (ul) se reemplaza por una tabla (table) -->
    <table class="table table-striped mb-0">

        <!-- Encabezado de la tabla para las columnas -->
        <thead class="table-light">
            <tr>
                <th scope="col">Consecuencia Emocional</th>
                <th scope="col" class="text-center">Nivel de Afectación</th>
            </tr>
        </thead>

        <!-- Cuerpo de la tabla donde se generan las filas con los datos -->
        <tbody>
            {% for consecuencia in cmentales.consecuencias_emocionales %}
            <tr>
                <!-- Celda para el nombre de la consecuencia -->
                <td class="align-middle">
                    {{ consecuencia.nombre }}
                </td>

                <!-- Celda para la severidad con colores condicionales -->
                <td class="text-center align-middle">
                    {% if consecuencia.severidad == 'Bastante' %}
                        <strong class="text-danger">{{ consecuencia.severidad }}</strong>

                    {% elif consecuencia.severidad == 'Regular' %}
                        <strong class="text-warning">{{ consecuencia.severidad }}</strong>

                    {% elif consecuencia.severidad == 'Poco' %}
                        <strong class="text-primary">{{ consecuencia.severidad }}</strong>

                    {% else %}
                        <strong>{{ consecuencia.severidad }}</strong>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <!-- Fila especial para cuando no hay datos -->
            <tr>
                <td colspan="2" class="text-center text-muted">
                    Sin consecuencias emocionales registradas.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>


                </div>
            </div>
          <div class="tab-pane fade show " id="relaciones-panel" role="tabpanel" aria-labelledby="relaciones-tab">
                <div class="card shadow-sm">
                    <div class="card-body p-0"> <!-- p-0 para un ajuste perfecto de la tabla dentro de la tarjeta -->

    <!-- La lista se convierte en una tabla con estilos de Bootstrap -->
    <table class="table table-striped mb-0">

        <!-- Encabezado de la tabla -->
        <thead class="table-light">
            <tr>
                <th scope="col">Consecuencia Relacional</th>
                <th scope="col" class="text-center">Nivel de Afectación</th>
            </tr>
        </thead>

        <!-- Cuerpo de la tabla con los datos del bucle -->
        <tbody>
            {% for consecuencia in crelaciones.consecuencias_relaciones %}
            <tr>
                <!-- Celda para el nombre -->
                <td class="align-middle">
                    {{ consecuencia.nombre }}
                </td>

                <!-- Celda para la severidad, con colores -->
                <td class="text-center align-middle">
                    {% if consecuencia.severidad == 'Bastante' %}
                        <strong class="text-danger">{{ consecuencia.severidad }}</strong>

                    {% elif consecuencia.severidad == 'Regular' %}
                        <strong class="text-warning">{{ consecuencia.severidad }}</strong>

                    {% elif consecuencia.severidad == 'Poco' %}
                        <strong class="text-primary">{{ consecuencia.severidad }}</strong>

                    {% else %}
                        <strong>{{ consecuencia.severidad }}</strong>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <!-- Fila que se muestra si no hay datos -->
            <tr>
                <td colspan="2" class="text-center text-muted">
                    Sin consecuencias en relaciones con otros registradas.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>


                </div>
            </div>
                <div class="tab-pane fade show " id="legal-panel" role="tabpanel" aria-labelledby="legal-tab">
                <div class="card shadow-sm">
                    <div class="card-body p-0"> <!-- p-0 para que la tabla se ajuste a los bordes de la tarjeta -->

    <!-- La lista se convierte en una tabla con estilos de Bootstrap -->
    <table class="table table-striped mb-0">

        <!-- Encabezado de la tabla -->
        <thead class="table-light">
            <tr>
                <th scope="col">Consecuencia Legal</th>
                <th scope="col" class="text-center">Nivel de Afectación</th>
            </tr>
        </thead>

        <!-- Cuerpo de la tabla con los datos -->
        <tbody>
            {% for consecuencia in crelaciones.consecuencias_legal %}
            <tr>
                <!-- Celda para el nombre de la consecuencia -->
                <td class="align-middle">
                    {{ consecuencia.nombre }}
                </td>

                <!-- Celda para la severidad con colores condicionales -->
                <td class="text-center align-middle">
                    {% if consecuencia.severidad == 'Bastante' %}
                        <strong class="text-danger">{{ consecuencia.severidad }}</strong>

                    {% elif consecuencia.severidad == 'Regular' %}
                        <strong class="text-warning">{{ consecuencia.severidad }}</strong>

                    {% elif consecuencia.severidad == 'Poco' %}
                        <strong class="text-primary">{{ consecuencia.severidad }}</strong>

                    {% else %}
                        <strong>{{ consecuencia.severidad }}</strong>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <!-- Fila que se muestra si no hay datos -->
            <tr>
                <td colspan="2" class="text-center text-muted">
                    <!-- CORRECCIÓN: Mensaje específico para esta sección -->
                    Sin consecuencias legales registradas.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>


                </div>
            </div>
        <div class="tab-pane fade show " id="economicos-panel" role="tabpanel" aria-labelledby="economicos-tab">
                <div class="card shadow-sm">
                  <div class="card-body p-0"> <!-- p-0 para un mejor ajuste de la tabla dentro de la tarjeta -->

    <!-- La estructura de lista se convierte en una tabla con estilos de Bootstrap -->
    <table class="table table-striped mb-0">

        <!-- Encabezado de la tabla -->
        <thead class="table-light">
            <tr>
                <th scope="col">Consecuencia Económica</th>
                <th scope="col" class="text-center">Nivel de Afectación</th>
            </tr>
        </thead>

        <!-- Cuerpo de la tabla con los datos generados por el bucle -->
        <tbody>
            {% for consecuencia in crelaciones.consecuencias_economicos %}
            <tr>
                <!-- Celda para el nombre de la consecuencia -->
                <td class="align-middle">
                    {{ consecuencia.nombre }}
                </td>

                <!-- Celda para la severidad con colores condicionales -->
                <td class="text-center align-middle">
                    {% if consecuencia.severidad == 'Bastante' %}
                        <strong class="text-danger">{{ consecuencia.severidad }}</strong>

                    {% elif consecuencia.severidad == 'Regular' %}
                        <strong class="text-warning">{{ consecuencia.severidad }}</strong>

                    {% elif consecuencia.severidad == 'Poco' %}
                        <strong class="text-primary">{{ consecuencia.severidad }}</strong>

                    {% else %}
                        <strong>{{ consecuencia.severidad }}</strong>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <!-- Fila especial que se muestra si no hay datos -->
            <tr>
                <td colspan="2" class="text-center text-muted">
                    <!-- CORRECCIÓN: Mensaje específico para esta sección -->
                    Sin consecuencias económicas registradas.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>


                </div>
            </div>
            <div class="tab-pane fade show " id="laboral-panel" role="tabpanel" aria-labelledby="laboral-tab">
                <div class="card shadow-sm">
                <div class="card-body p-0"> <!-- p-0 para que la tabla se ajuste a los bordes de la tarjeta -->

    <!-- La estructura de lista se convierte en una tabla con estilos de Bootstrap -->
    <table class="table table-striped mb-0">

        <!-- Encabezado de la tabla -->
        <thead class="table-light">
            <tr>
                <th scope="col">Consecuencia Laboral/Escolar</th>
                <th scope="col" class="text-center">Nivel de Afectación</th>
            </tr>
        </thead>

        <!-- Cuerpo de la tabla con los datos generados por el bucle -->
        <tbody>
            {% for consecuencia in crelaciones.consecuencias_laboralyescolar %}
            <tr>
                <!-- Celda para el nombre de la consecuencia -->
                <td class="align-middle">
                    {{ consecuencia.nombre }}
                </td>

                <!-- Celda para la severidad con colores condicionales -->
                <td class="text-center align-middle">
                    {% if consecuencia.severidad == 'Bastante' %}
                        <strong class="text-danger">{{ consecuencia.severidad }}</strong>

                    {% elif consecuencia.severidad == 'Regular' %}
                        <strong class="text-warning">{{ consecuencia.severidad }}</strong>

                    {% elif consecuencia.severidad == 'Poco' %}
                        <strong class="text-primary">{{ consecuencia.severidad }}</strong>

                    {% else %}
                        <strong>{{ consecuencia.severidad }}</strong>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <!-- Fila especial que se muestra si no hay datos -->
            <tr>
                <td colspan="2" class="text-center text-muted">
                    <!-- CORRECCIÓN: Mensaje específico para esta sección -->
                    Sin consecuencias laborales o escolares registradas.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
                </div>
            </div>


  <!-- Contenido del formulario -->
        </div>

 <form action="{% url 'graba-valorizacion' id=interno.pk %}" method="POST" >
    {% csrf_token %}

     {% if messages %}
    <div class="alert-messages">
      {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
      {% endfor %}
    </div>
    {% endif %}
<!-- No necesitas 'align-items-center' en la fila exterior si solo contiene una card -->
<div class="row">
    <!-- La card principal ahora ocupa toda la fila (o el tamaño que definas, ej. col-12) -->
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header">
                <strong>Comentarios y observaciones</strong>
            </div>
            <div class="card-body">

                <!-- CORRECCIÓN: Se crea una nueva fila DENTRO del card-body -->
                <!-- MEJORA: 'g-3' (gutter) añade un espacio entre las columnas/cards -->
                <div class="row g-3">

                    <!-- Columna 1 -->
                    <div class="col-md-4 d-flex">
                        <!-- MEJORA: 'h-100' hace que todas las cards tengan la misma altura -->
                        <div class="card shadow-sm h-100 w-100">
                            <div class="card-header">
                                Psicológicas
                            </div>
                            <div class="card-body">
                                {{ valorizacionf.psicologica }}
                            </div>
                        </div>
                    </div>

                    <!-- Columna 2 -->
                    <div class="col-md-4 d-flex">
                        <div class="card shadow-sm h-100 w-100">
                            <div class="card-header">Médicas</div>
                            <div class="card-body">
                                {{ valorizacionf.medico }}
                            </div>
                        </div>
                    </div>

                    <!-- Columna 3 -->
                    <div class="col-md-4 d-flex">
                        <div class="card shadow-sm h-100 w-100">
                            <div class="card-header">Psiquiátricas</div>
                            <div class="card-body">
                                {{ valorizacionf.psiquiatrica }}
                            </div>
                        </div>
                    </div>

                </div> <!-- Fin de la fila interna -->
            </div> <!-- Fin del card-body principal -->
        </div> <!-- Fin de la card principal -->
    </div> <!-- Fin de la columna principal -->
</div> <!-- Fin de la fila exterior -->




    <div class="text-end mt-4">
      <button type="submit" class="btn btn-primary btn-save ">
        <i class="bi bi-save"></i> Guardar
      </button>
    </div>




  </form>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
    // Seleccionamos los elementos usando las nuevas clases
    const tabButtons = document.querySelectorAll('.problemas-tab-button');
    const tabPanels = document.querySelectorAll('.problemas-tab-panel');

    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            const targetSelector = button.dataset.tabTarget;
            const targetPanel = document.querySelector(targetSelector);

            // Quitar 'active' de todos
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabPanels.forEach(panel => panel.classList.remove('active'));

            // Añadir 'active' al botón correcto y a su panel
            button.classList.add('active');
            targetPanel.classList.add('active');
        });
    });
});
</script>





<!-- Estilos personalizados -->


 </body>
{% endblock %}
