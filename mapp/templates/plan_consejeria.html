{% extends "dgenerales.html" %}

<body>
{% block content %}
{% load forms_tags %}
{% load custom_filters %}
{% load form_utils %}

<div class="interview-container">
  <!-- Header Sticky -->
  <div class="header-content sticky-top">
    <div class="header-title">
      <div class="d-flex justify-content-between align-items-start">
        <div>
          <h3>Plan de consejeria</h3>
        </div>
        <div>
          <!-- Bot贸n Regresar -->
          <a href="{% url 'seleccionainterno' id=interno.pk %}"
                   class="btn btn-outline-secondary btn-sm">
            <i class="bi bi-arrow-left me-1"></i> Regresar
          </a>
        </div>
      </div>

      <!-- Informaci贸n del paciente -->
      <div class="patient-info d-flex justify-content-between align-items-center flex-wrap">
        <div class="d-flex flex-wrap align-items-center gap-3">
          <div class="patient-id">
            <span class="badge bg-secondary">Expediente:</span>
            <span class="fw-bold">{{ interno.numeroexpediente }}</span>
          </div>
          <div class="patient-name">
            <span class="badge bg-secondary">Nombre:</span>
            <span class="fw-bold">{{ interno.nombrecompleto }}</span>
          </div>
        </div>

        <!-- Elementos de la derecha -->
        <div class="d-flex align-items-center gap-3">
          <div class="fecha-sesion">
            <span class="badge bg-primary">Fecha:</span>
            <span>{{ pconsejeriaf.fecha }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Formulario principal -->
  <form action="{% url 'planConsejeria' id=interno.numeroexpediente %}" method="POST">
    {% csrf_token %}
  <input type="hidden" name="expediente" value="{{ interno.numeroexpediente }}">
    <!-- MOSTRAR ERRORES DEL FORMULARIO -->
    {% if pconsejeriaf.errors %}
    <div class="alert alert-danger mt-3">
      <h5><i class="bi bi-exclamation-triangle me-2"></i>Errores en el formulario:</h5>
      <ul class="mb-0">
        {% for field in pconsejeriaf %}
          {% for error in field.errors %}
            <li><strong>{{ field.label }}:</strong> {{ error }}</li>
          {% endfor %}
        {% endfor %}
        {% for error in pconsejeriaf.non_field_errors %}
          <li>{{ error }}</li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}

    <!-- Mensajes de alerta -->
    {% if messages %}
    <div class="alert-messages mt-3">
      {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        <i class="bi bi-info-circle me-2"></i>{{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- Secci贸n de captura -->
    <div class="card shadow-sm mt-3">
      <div class="card-header bg-light">
        <h5 class="mb-0">Detalles del Plan de consejeria</h5>
      </div>

      <div class="card-body">
        <!-- Campos del formulario -->
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="{{ pconsejeriaf.alcoholydrogas.id_for_label }}" class="form-label fw-bold">
              {{ pconsejeriaf.alcoholydrogas.label }}
            </label>
            {{ pconsejeriaf.alcoholydrogas }}
            {% if pconsejeriaf.alcoholydrogas.errors %}
              <div class="text-danger small">{{ pconsejeriaf.alcoholydrogas.errors }}</div>
            {% endif %}
          </div>
          <div class="col-md-6 mb-3">
            <label for="{{ pconsejeriaf.fisicaymental.id_for_label }}" class="form-label fw-bold">
              {{ pconsejeriaf.fisicaymental.label }}
            </label>
            {{ pconsejeriaf.fisicaymental }}
            {% if pconsejeriaf.fisicaymental.errors %}
              <div class="text-danger small">{{ pconsejeriaf.fisicaymental.errors }}</div>
            {% endif %}
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="{{ pconsejeriaf.areasdelavida.id_for_label }}" class="form-label fw-bold">
              {{ pconsejeriaf.areasdelavida.label }}
            </label>
            {{ pconsejeriaf.areasdelavida }}
            {% if pconsejeriaf.areasdelavida.errors %}
              <div class="text-danger small">{{ pconsejeriaf.areasdelavida.errors }}</div>
            {% endif %}
          </div>
          <div class="col-md-6 mb-3">
            <label for="{{ pconsejeriaf.metas.id_for_label }}" class="form-label fw-bold">
              {{ pconsejeriaf.metas.label }}
            </label>
            {{ pconsejeriaf.metas }}
            {% if pconsejeriaf.metas.errors %}
              <div class="text-danger small">{{ pconsejeriaf.metas.errors }}</div>
            {% endif %}
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="{{ pconsejeriaf.objetivos.id_for_label }}" class="form-label fw-bold">
              {{ pconsejeriaf.objetivos.label }}
            </label>
            {{ pconsejeriaf.objetivos }}
            {% if pconsejeriaf.objetivos.errors %}
              <div class="text-danger small">{{ pconsejeriaf.objetivos.errors }}</div>
            {% endif %}
          </div>
          <div class="col-md-6 mb-3">
            <label for="{{ pconsejeriaf.compromiso.id_for_label }}" class="form-label fw-bold">
              {{ pconsejeriaf.compromiso.label }}
            </label>
            {{ pconsejeriaf.compromiso }}
            {% if pconsejeriaf.compromiso.errors %}
              <div class="text-danger small">{{ pconsejeriaf.compromiso.errors }}</div>
            {% endif %}
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="{{ pconsejeriaf.logros.id_for_label }}" class="form-label fw-bold">
              {{ pconsejeriaf.logros.label }}
            </label>
            {{ pconsejeriaf.logros }}
            {% if pconsejeriaf.logros.errors %}
              <div class="text-danger small">{{ pconsejeriaf.logros.errors }}</div>
            {% endif %}
          </div>
          <div class="col-md-6 mb-3">
            <label for="{{ pconsejeriaf.metasareasdevida.id_for_label }}" class="form-label fw-bold">
              {{ pconsejeriaf.metasareasdevida.label }}
            </label>
            {{ pconsejeriaf.metasareasdevida }}
            {% if pconsejeriaf.metasareasdevida.errors %}
              <div class="text-danger small">{{ pconsejeriaf.metasareasdevida.errors }}</div>
            {% endif %}
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="{{ pconsejeriaf.prevencion.id_for_label }}" class="form-label fw-bold">
              {{ pconsejeriaf.prevencion.label }}
            </label>
            {{ pconsejeriaf.prevencion }}
            {% if pconsejeriaf.prevencion.errors %}
              <div class="text-danger small">{{ pconsejeriaf.prevencion.errors }}</div>
            {% endif %}
          </div>
        </div>

        <!-- Botones de acci贸n -->
        <div class="d-flex justify-content-between mt-4">
          <a href="{% url 'seleccionainterno' id=interno.numeroexpediente %}" class="btn btn-outline-secondary me-2">
            <i class="bi bi-arrow-left me-1"></i> Regresar
          </a>
          <button type="submit" class="btn btn-primary">
            Guardar
          </button>
        </div>
      </div>
    </div>
  </form>
</div>

<style>
.interview-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 15px 30px;
}

.header-content {
  background: white;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  padding: 15px 0;
  margin-bottom: 20px;
}

/* Estilos responsive */
@media (max-width: 768px) {
  .interview-container {
    padding: 0 10px;
  }

  .patient-info {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }

  .col-md-6 {
    width: 100%;
  }
}
</style>

{% endblock %}