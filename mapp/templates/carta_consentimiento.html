{% extends "dgenerales.html" %}

{% block content %}

<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consentimiento Informado - {{datosgrales.nombre}}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.3;
            margin: 0;
            padding: 20px;
            color: #000;
            font-size: 12px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 10px;
        }

        .logo-container {
            flex: 0 0 auto;
            margin-right: 20px;
        }

        .logo {
            max-width: 80px;
            height: auto;
        }

        .clinic-info {
            flex: 1;
        }

        .organization {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 3px;
        }

        .rfc {
            font-size: 12px;
            margin-bottom: 3px;
        }

        .address {
            font-size: 12px;
            margin-bottom: 3px;
        }

        .expediente-info {
            text-align: right;
            margin-bottom: 25px;
            font-size: 12px;
        }

        .titulo {
            text-align: center;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 25px;
            text-decoration: underline;
        }

        .destinatario {
            margin-bottom: 20px;
        }

        .contenido {
            margin-bottom: 25px;
            text-align: justify;
        }

        .firma {
            margin-top: 60px;
            text-align: center;
        }

        .linea-firma {
            width: 300px;
            border-top: 1px solid #000;
            margin: 40px auto 5px auto;
        }

        .nombre-firma {
            font-weight: bold;
        }

        .sello {
            text-align: center;
            margin-top: 40px;
            font-style: italic;
            font-size: 11px;
        }

        @media print {
            @page {
                margin: 15mm;
                size: letter;
            }

            body {
                padding: 0;
                margin: 0;
                font-size: 11px;
                line-height: 1.2;
            }

            .container {
                padding: 0;
                max-width: 100%;
                margin: 0 auto;
            }

            .no-print {
                display: none;
            }

            .header {
                border-bottom: 1px solid #000;
                margin-bottom: 15px;
                padding-bottom: 8px;
            }

            .logo {
                max-width: 70px;
            }
        }

        .no-print {
            text-align: center;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .print-btn {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }

        .close-btn {
            padding: 10px 20px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="no-print">
            <button onclick="window.print()" class="print-btn">
                Imprimir Consentimiento
            </button>
            <button onclick="cerrarVentana()" class="close-btn">
                Cerrar
            </button>
        </div>

        <!-- Encabezado con logo -->
        <div class="header">

       <div class="logo-container">
    {% if datosgrales.logo_url %}
        <!-- ✅ MOSTRAR IMGBB -->
        <img src="{{ datosgrales.logo_url }}" alt="Logo {{ datosgrales.nombre }}" class="logo">

    {% elif datosgrales.logo_clinica %}
        <!-- ❌ Imagen local (no funciona en producción) -->
        <img src="{{ datosgrales.logo_clinica.url }}" alt="Logo {{ datosgrales.nombre }}" class="logo">
    {% else %}
        <p>❌ NO hay logo subido</p>
    {% endif %}
</div>

            <div class="clinic-info">
                <div class="organization">{{datosgrales.nombre}}</div>
                <div class="rfc">RFC: {{datosgrales.rfc}}</div>
                <div class="address">{{datosgrales.calleynumero}}, {{datosgrales.colonia}}</div>
                <div class="address">{{datosgrales.ciudad}} {{datosgrales.estado}}, {{datosgrales.cp}}</div>
                <div class="address">WEB: {{datosgrales.sitioweb}} Email: {{datosgrales.email}}</div>
                <div class="address">Teléfono: {{datosgrales.telefono}}</div>
            </div>
        </div>

        <!-- Información del expediente -->
        <div class="expediente-info">
            <strong>Expediente: {{interno.expediente}}</strong><br>
            <strong>Fecha y Hora: {{ fecha_actual }}</strong>
        </div>

        <!-- Título -->
        <div class="titulo">
            CONSENTIMIENTO INFORMADO
        </div>

        <!-- Destinatario -->
        <div class="destinatario">
            <strong>C. DIRECTOR O RESPONSABLE DEL ESTABLECIMIENTO</strong><br>
            <strong>PRESENTE</strong>
        </div>

        <!-- Contenido principal -->
        <div class="contenido">
            <p>
                EL(LA) QUE SUSCRIBE <strong>C. {{interno.nombrecompleto}}</strong>
            </p>

            <p>
                OTORGO MI CONSENTIMIENTO PARA RECIBIR EL TRATAMIENTO EL CUAL CONSISTE EN:<br>
                <strong>REUNIONES Y SESIONES DE LOS 12 PASOS DE N.A., TERAPIA OCUPACIONAL, TRATAMIENTO PSICOLÓGICO Y DIVERSAS ACTIVIDADES</strong>
            </p>

            <p>
                CON UNA DURACIÓN DE <strong>{{interno.duracion}}</strong>
            </p>

            <p>
                HACIENDO CONSTAR QUE FUI INFORMADO DE TODOS Y CADA UNO DE LOS PROCEDIMIENTOS, IMPLICACIONES Y RIESGOS QUE ESTE IMPLICA, ASÍ COMO LOS ESTATUTOS, REGLAMENTO INTERNO Y DE LAS CONDICIONES DE INGRESO, ESTANCIA Y EGRESO DEL ESTABLECIMIENTO, INFORMACIÓN QUE ME FUE PROPORCIONADA DETALLADAMENTE POR EL O LA C. RESPONSABLE DEL CENTRO DE TRATAMIENTO <strong>{{datosgrales.nombre}}</strong>.
            </p>

            <p>
                LO ANTERIOR APEGADO A LO DISPUESTO EN EL APARTADO 10.3.1 DE LA NORMA OFICIAL MEXICANA NOM-028-2009, PARA LA PREVENCIÓN, TRATAMIENTO Y CONTROL DE ADICCIONES.
            </p>
        </div>

        <!-- Firma del paciente -->
        <div class="firma">
            <div class="linea-firma"></div>
            <div class="nombre-firma">C. {{interno.nombrecompleto}}</div>
            <div>PACIENTE</div>
        </div>

        <!-- Sello y fecha -->
        <div class="sello">
            <p>RECIBÍ Y ENTENDÍ LA INFORMACIÓN<br>
            FECHA: _________________________</p>
        </div>

        <!-- Firma del responsable -->
        <div class="firma" style="margin-top: 80px;">
            <div class="linea-firma"></div>
            <div class="nombre-firma">{{datosgrales.responsable}}</div>
            <div>{{datosgrales.cargo}}</div>
        </div>
    </div>

    <script>

      function cerrarVentana() {
            // Intentar cerrar la ventana
            if (window.history.length > 1) {
                // Si hay historial, regresar
                window.history.back();
            } else {
                // Si no hay historial, cerrar la ventana
                window.close();

                // Fallback: redirigir después de 1 segundo si no se cerró
                setTimeout(function() {
                    if (!window.closed) {
                        window.location.href = '/'; // Cambia por tu URL principal
                    }
                }, 1000);
            }
        }



        // Establecer fecha actual si no viene del backend
        document.addEventListener('DOMContentLoaded', function() {
            if (!document.querySelector('.expediente-info strong').textContent.includes('{{ fecha_actual }}')) {
                const now = new Date();
                const options = { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' };
                const fechaHora = now.toLocaleDateString('es-MX', options) + ' ' + (now.getHours() >= 12 ? 'PM' : 'AM');
                document.querySelector('.expediente-info strong:nth-child(2)').textContent = 'Fecha y Hora: ' + fechaHora;
            }
        });
    </script>
</body>


{% endblock %}